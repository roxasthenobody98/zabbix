---
test case: Fail ''
in:
  flags: []
  expression: ''
out:
  result: FAIL
--- # numeric variables
test case: Succeed '0'
in:
  flags: []
  expression: '0'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_NUM
    token: '0'
    opt: 0
  result: SUCCEED
---
test case: Succeed '0.1'
in:
  flags: []
  expression: '0.1'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_NUM
    token: '0.1'
    opt: 0
  result: SUCCEED
---
test case: Fail '.1'
in:
  flags: []
  expression: '.1'
out:
  result: FAIL
---
test case: Succeed '1.'
in:
  flags: []
  expression: '1.'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_NUM
    token: '1.'
    opt: 0
  result: SUCCEED
---
test case: Fail '1.1.'
in:
  flags: []
  expression: '1.1.'
out:
  result: FAIL
---
test case: Succeed '1e10'
in:
  flags: []
  expression: '1e10'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_NUM
    token: '1e10'
    opt: 0
  result: SUCCEED
---
test case: Fail '1e1000'
in:
  flags: []
  expression: '1e1000'
out:
  result: FAIL
--- # string variables
test case: Succeed '"xyz"'
in:
  flags: []
  expression: '"xyz"'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_STR
    token: '"xyz"'
    opt: 0
  result: SUCCEED
---
test case: Succeed '"x\\\"y\"z/"'
in:
  flags: []
  expression: '"x\\\"y\"z/"'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_STR
    token: '"x\\\"y\"z/"'
    opt: 0
  result: SUCCEED
---
test case: Fail '"x\yz"'
in:
  flags: []
  expression: '"x\yz"'
out:
  result: FAIL
---
test case: Succeed '""'
in:
  flags: []
  expression: '""'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_STR
    token: '""'
    opt: 0
  result: SUCCEED
---
test case: Fail '"xyz'
in:
  flags: []
  expression: '"xyz'
out:
  result: FAIL
---
test case: Fail '"xyz\"'
in:
  flags: []
  expression: '"xyz\"'
out:
  result: FAIL
--- # functionid
test case: Succeed '{1}'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTIONID]
  expression: '{1}'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_FUNCTIONID
    token: '{1}'
    opt: 0
  result: SUCCEED
---
test case: Succeed '{1}'
in:
  flags: [ZBX_EVAL_PARSE_MACRO]
  expression: '{1}'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_MACRO
    token: '{1}'
    opt: 0
  result: SUCCEED
---
test case: Fail '{1}'
in:
  flags: []
  expression: '{1}'
out:
  result: FAIL
--- # macros
test case: Succeed '{MACRO}'
in:
  flags: [ZBX_EVAL_PARSE_MACRO]
  expression: '{MACRO}'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_MACRO
    token: '{MACRO}'
    opt: 0
  result: SUCCEED
--- # user macros
test case: Succeed '{$MACRO}'
in:
  flags: [ZBX_EVAL_PARSE_USERMACRO]
  expression: '{$MACRO}'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_USERMACRO
    token: '{$MACRO}'
    opt: 0
  result: SUCCEED
---
test case: Succeed '{$MACRO:context}'
in:
  flags: [ZBX_EVAL_PARSE_USERMACRO]
  expression: '{$MACRO:context}'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_USERMACRO
    token: '{$MACRO:context}'
    opt: 0
  result: SUCCEED
---
test case: Fail '{$MACRO:context'
in:
  flags: [ZBX_EVAL_PARSE_USERMACRO]
  expression: '{$MACRO:context'
out:
  result: FAIL
---
test case: Succeed '{$MACRO:"context:\"context\""}'
in:
  flags: [ZBX_EVAL_PARSE_USERMACRO]
  expression: '{$MACRO:"context:\"context\""}'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_USERMACRO
    token: '{$MACRO:"context:\"context\""}'
    opt: 0
  result: SUCCEED
---
test case: Fail '{$MACRO:"context:\"context\"}'
in:
  flags: [ZBX_EVAL_PARSE_USERMACRO]
  expression: '{$MACRO:"context:\"context\"}'
out:
  result: FAIL
--- # LLD macros
test case: Succeed '{#LLD}'
in:
  flags: [ZBX_EVAL_PARSE_LLDMACRO]
  expression: '{#LLD}'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_LLDMACRO
    token: '{#LLD}'
    opt: 0
  result: SUCCEED
---
test case: Fail '{#LLD}'
in:
  flags: []
  expression: '{#LLD}'
out:
  result: FAIL
---
test case: Fail '{#LLD'
in:
  flags: [ZBX_EVAL_PARSE_LLDMACRO]
  expression: '{#LLD'
out:
  result: FAIL
--- # parenthesis
test case: Fail '()'
in:
  flags: []
  expression: '()'
out:
  result: FAIL
---
test case: Succeed '(0)'
in:
  flags: []
  expression: '(0)'
out:
  stack: 
  - type: ZBX_EVAL_TOKEN_VAR_NUM
    token: '0'
    opt: 0
  result: SUCCEED
---
test case: Fail '(0'
in:
  flags: []
  expression: '(0'
out:
  result: FAIL
---
test case: Fail '0)'
in:
  flags: []
  expression: '0)'
out:
  result: FAIL
---
test case: Succeed '((0))'
in:
  flags: []
  expression: '((0))'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '0', opt: 0}
  result: SUCCEED
--- # unary minus operations
test case: Fail '-'
in:
  flags: []
  expression: '-'
out:
  result: FAIL
---
test case: Succeed '-1'
in:
  flags: []
  expression: '-1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '-(1)'
in:
  flags: []
  expression: '-(1)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '-{MACRO}'
in:
  flags: [ZBX_EVAL_PARSE_MACRO]
  expression: '-{MACRO}'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_MACRO, token: '{MACRO}', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '--1'
in:
  flags: []
  expression: '--1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '- - 1'
in:
  flags: []
  expression: '- - 1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '-(-1)'
in:
  flags: []
  expression: '-(-1)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  result: SUCCEED
--- # arithmetic operations
test case: Fail '+'
in:
  flags: []
  expression: '+'
out:
  result: FAIL
---
test case: Fail '-'
in:
  flags: []
  expression: '-'
out:
  result: FAIL
---
test case: Fail '/'
in:
  flags: []
  expression: '/'
out:
  result: FAIL
---
test case: Fail '*'
in:
  flags: []
  expression: '*'
out:
  result: FAIL
---
test case: Fail '1+'
in:
  flags: []
  expression: '1+'
out:
  result: FAIL
---
test case: Fail '1-'
in:
  flags: []
  expression: '1-'
out:
  result: FAIL
---
test case: Fail '1/'
in:
  flags: []
  expression: '1/'
out:
  result: FAIL
---
test case: Fail '1*'
in:
  flags: []
  expression: '1*'
out:
  result: FAIL
---
test case: Fail '+1'
in:
  flags: []
  expression: '+1'
out:
  result: FAIL
---
test case: Fail '/1'
in:
  flags: []
  expression: '/1'
out:
  result: FAIL
---
test case: Fail '*1'
in:
  flags: []
  expression: '*1'
out:
  result: FAIL
---
test case: Succeed '1+2'
in:
  flags: []
  expression: '1+2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Succeed '1+2-3'
in:
  flags: []
  expression: '1+2-3'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '1-2+3'
in:
  flags: []
  expression: '1-2+3'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Fail '2**1'
in:
  flags: []
  expression: '2**1'
out:
  result: FAIL
---
test case: Fail '2++1'
in:
  flags: []
  expression: '2++1'
out:
  result: FAIL
---
test case: Fail '2//1'
in:
  flags: []
  expression: '2//1'
out:
  result: FAIL
---
test case: Succeed '2--1'
in:
  flags: []
  expression: '2--1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '1+2*3'
in:
  flags: []
  expression: '1+2*3'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MUL, token: '*', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Succeed '1*2+3'
in:
  flags: []
  expression: '1*2+3'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MUL, token: '*', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Succeed '1+2*3-4'
in:
  flags: []
  expression: '1+2*3-4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MUL, token: '*', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed '1/2+3*4'
in:
  flags: []
  expression: '1/2+3*4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_DIV, token: '/', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MUL, token: '*', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Succeed '1/(2+3)*4'
in:
  flags: []
  expression: '1/(2+3)*4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_DIV, token: '/', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MUL, token: '*', opt: 0}
  result: SUCCEED
---
test case: Succeed '1+(2-(3+4))'
in:
  flags: []
  expression: '1+(2-(3+4))'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Succeed '((1+2)-3)+4'
in:
  flags: []
  expression: '((1+2)-3)+4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
--- # comparison operators
test case: Succeed '1=2'
in:
  flags: []
  expression: '1=2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_EQ, token: '=', opt: 0}
  result: SUCCEED
---
test case: Succeed '1<>2'
in:
  flags: []
  expression: '1<>2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NE, token: '<>', opt: 0}
  result: SUCCEED
---
test case: Succeed '1<2'
in:
  flags: []
  expression: '1<2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_LT, token: '<', opt: 0}
  result: SUCCEED
---
test case: Succeed '1<=2'
in:
  flags: []
  expression: '1<=2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_LE, token: '<=', opt: 0}
  result: SUCCEED
---
test case: Succeed '1>2'
in:
  flags: []
  expression: '1>2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_GT, token: '>', opt: 0}
  result: SUCCEED
---
test case: Succeed '1>=2'
in:
  flags: []
  expression: '1>=2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_GE, token: '>=', opt: 0}
  result: SUCCEED
---
test case: Fail '1='
in:
  flags: []
  expression: '1='
out:
  result: FAIL
---
test case: Fail '1<>'
in:
  flags: []
  expression: '1<>'
out:
  result: FAIL
---
test case: Fail '1<'
in:
  flags: []
  expression: '1<'
out:
  result: FAIL
---
test case: Fail '1<='
in:
  flags: []
  expression: '1<='
out:
  result: FAIL
---
test case: Fail '1>'
in:
  flags: []
  expression: '1>'
out:
  result: FAIL
---
test case: Fail '1>='
in:
  flags: []
  expression: '1>='
out:
  result: FAIL
---
test case: Fail '=1'
in:
  flags: []
  expression: '=1'
out:
  result: FAIL
---
test case: Fail '<>1'
in:
  flags: []
  expression: '<>1'
out:
  result: FAIL
---
test case: Fail '<1'
in:
  flags: []
  expression: '<1'
out:
  result: FAIL
---
test case: Fail '<=1'
in:
  flags: []
  expression: '<=1'
out:
  result: FAIL
---
test case: Fail '>1'
in:
  flags: []
  expression: '>1'
out:
  result: FAIL
---
test case: Fail '>=1'
in:
  flags: []
  expression: '>=1'
out:
  result: FAIL
---
test case: Fail '1==1'
in:
  flags: []
  expression: '1==1'
out:
  result: FAIL
---
test case: Fail '1=<1'
in:
  flags: []
  expression: '1=<1'
out:
  result: FAIL
---
test case: Fail '1=>1'
in:
  flags: []
  expression: '1=>1'
out:
  result: FAIL
---
test case: Succeed '3 > 2 <> 1'
in:
  flags: []
  expression: '3 > 2 <> 1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_GT, token: '>', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NE, token: '<>', opt: 0}
  result: SUCCEED
--- # mixed arithmetic and comparison operators
test case: Succeed '3 = 2 + 1'
in:
  flags: []
  expression: '3 = 2 + 1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_EQ, token: '=', opt: 0}
  result: SUCCEED
---
test case: Succeed '(3 = 2) + 1'
in:
  flags: []
  expression: '(3 = 2) + 1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_EQ, token: '=', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Fail '1=+2'
in:
  flags: []
  expression: '1=+2'
out:
  result: FAIL
---
test case: Fail '1+=2'
in:
  flags: []
  expression: '1+=2'
out:
  result: FAIL
---
test case: Succeed '1=-2'
in:
  flags: []
  expression: '1=-2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_MINUS, token: '-', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_EQ, token: '=', opt: 0}
  result: SUCCEED
--- # logical not
test case: Succeed 'not 1'
in:
  flags: []
  expression: 'not 1'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NOT, token: 'not', opt: 0}
  result: SUCCEED
---
test case: Fail 'not1'
in:
  flags: []
  expression: 'not1'
out:
  result: FAIL
---
test case: Succeed 'not(1)'
in:
  flags: []
  expression: 'not(1)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NOT, token: 'not', opt: 0}
  result: SUCCEED
---
test case: Succeed 'not 1 + 2'
in:
  flags: []
  expression: 'not 1 + 2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NOT, token: 'not', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  result: SUCCEED
---
test case: Succeed 'not (1 + 2)'
in:
  flags: []
  expression: 'not (1 + 2)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NOT, token: 'not', opt: 0}
  result: SUCCEED
---
test case: Succeed '(not 1)'
in:
  flags: []
  expression: '(not 1)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NOT, token: 'not', opt: 0}
  result: SUCCEED
---
test case: Succeed '1 = not 2'
in:
  flags: []
  expression: '1 = not 2'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_NOT, token: 'not', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_EQ, token: '=', opt: 0}
  result: SUCCEED
---
test case: Fail '1 + not'
in:
  flags: []
  expression: '1 + not'
out:
  result: FAIL
--- # constant variable index
test case: Succeed '1+2*3-{MACRO}'
in:
  flags: [ZBX_EVAL_PARSE_CONST_INDEX,ZBX_EVAL_PARSE_MACRO]
  expression: '1+2*3-{MACRO}'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 1}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 2}
  - {type: ZBX_EVAL_TOKEN_OP_MUL, token: '*', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_MACRO, token: '{MACRO}', opt: 3}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  result: SUCCEED
--- # logical and/or
test case: Succeed '1=2 or 3<4'
in:
  flags: []
  expression: '1=2 or 3<4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_EQ, token: '=', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_LT, token: '<', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_OR, token: 'or', opt: 0}
  result: SUCCEED
---
test case: Succeed '1=2 and 3<4'
in:
  flags: []
  expression: '1=2 and 3<4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_EQ, token: '=', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_LT, token: '<', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_AND, token: 'and', opt: 0}
  result: SUCCEED
---
test case: Succeed '1 or 2 and 3 or 4'
in:
  flags: []
  expression: '1 or 2 and 3 or 4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_AND, token: 'and', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_OR, token: 'or', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_OR, token: 'or', opt: 0}
  result: SUCCEED
---
test case: Succeed '1 or 2 and 3 or 4'
in:
  flags: []
  expression: '1 and 2 or 3 and 4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_AND, token: 'and', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_AND, token: 'and', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_OR, token: 'or', opt: 0}
  result: SUCCEED
---
test case: Fail '1 and'
in:
  flags: []
  expression: '1 and'
out:
  result: FAIL
---
test case: Fail '1 or'
in:
  flags: []
  expression: '1 or'
out:
  result: FAIL
---
test case: Fail 'and 1'
in:
  flags: []
  expression: 'and 1'
out:
  result: FAIL
---
test case: Fail 'or 1'
in:
  flags: []
  expression: 'or 1'
out:
  result: FAIL
---
test case: Fail '1 and1'
in:
  flags: []
  expression: '1 and1'
out:
  result: FAIL
---
test case: Fail '1and 1'
in:
  flags: []
  expression: '1and 1'
out:
  result: FAIL
---
test case: Succeed '(1)and(2)'
in:
  flags: []
  expression: '(1)and(2)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_OP_AND, token: 'and', opt: 0}
  result: SUCCEED
--- # math functions
test case: Succeed 'min()'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min()'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 0}
  result: SUCCEED
---
test case: Fail 'min('
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min('
out:
  result: FAIL
---
test case: Succeed 'min(1)'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(1)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 1}
  result: SUCCEED
---
test case: Succeed 'min(1,2)'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(1,2)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
---
test case: Succeed 'min(1,)'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(1,)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_ARG_NULL, token: '', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
---
test case: Succeed 'min(,)'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(,)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_ARG_NULL, token: '', opt: 0}
  - {type: ZBX_EVAL_TOKEN_ARG_NULL, token: '', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
---
test case: Succeed 'min(1,"xyz")'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(1,"xyz")'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_STR, token: '"xyz"', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
---
test case: Succeed 'min(1,{$MACRO:context,})'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION,ZBX_EVAL_PARSE_USERMACRO]
  expression: 'min(1,{$MACRO:context,})'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_USERMACRO, token: '{$MACRO:context,}', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
---
test case: Succeed '1 + min(2, 3) - 4'
in:
  flags: [ZBX_EVAL_PARSE_CONST_INDEX,ZBX_EVAL_PARSE_FUNCTION]
  expression: '1 + min(2, 3) - 4'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 2}
  - {type: ZBX_EVAL_TOKEN_OP_ADD, token: '+', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 1}
  - {type: ZBX_EVAL_TOKEN_OP_SUB, token: '-', opt: 0}
  result: SUCCEED
---
test case: Succeed 'avg(min(1, 2), 3, max(4, 5, 6))'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'avg(min(1, 2), 3, max(4, 5, 6))'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 2}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '3', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '4', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '5', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '6', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'max', opt: 3}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'avg', opt: 3}
  result: SUCCEED
---
test case: Succeed 'min(1, , 2)'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(1, , 2)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_ARG_NULL, token: '', opt: 0}
  - {type: ZBX_EVAL_TOKEN_VAR_NUM, token: '2', opt: 0}
  - {type: ZBX_EVAL_TOKEN_MATH_FUNCTION, token: 'min', opt: 3}
  result: SUCCEED
---
test case: Succeed 'min(/host/key,1)'
in:
  flags: [ZBX_EVAL_PARSE_ITEM_QUERY,ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(/host/key,1)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_ARG_QUERY, token: '/host/key', opt: 0}
  - {type: ZBX_EVAL_TOKEN_ARG_TIME, token: '1', opt: 0}
  - {type: ZBX_EVAL_TOKEN_HIST_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
---
test case: Fail 'min(/host/key,1)'
in:
  flags: [ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(/host/key,1)'
out:
  result: FAIL
---
test case: Fail 'min(,1m)'
in:
  flags: [ZBX_EVAL_PARSE_ITEM_QUERY,ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(,1m)'
out:
  result: FAIL
---
test case: Succeed 'min(/host/key,5m)'
in:
  flags: [ZBX_EVAL_PARSE_ITEM_QUERY,ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(/host/key,5m)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_ARG_QUERY, token: '/host/key', opt: 0}
  - {type: ZBX_EVAL_TOKEN_ARG_TIME, token: '5m', opt: 0}
  - {type: ZBX_EVAL_TOKEN_HIST_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
---
test case: Succeed 'min(/host/key,5m:now-1h)'
in:
  flags: [ZBX_EVAL_PARSE_ITEM_QUERY,ZBX_EVAL_PARSE_FUNCTION]
  expression: 'min(/host/key,5m:now-1h)'
out:
  stack: 
  - {type: ZBX_EVAL_TOKEN_ARG_QUERY, token: '/host/key', opt: 0}
  - {type: ZBX_EVAL_TOKEN_ARG_TIME, token: '5m:now-1h', opt: 0}
  - {type: ZBX_EVAL_TOKEN_HIST_FUNCTION, token: 'min', opt: 2}
  result: SUCCEED
...




